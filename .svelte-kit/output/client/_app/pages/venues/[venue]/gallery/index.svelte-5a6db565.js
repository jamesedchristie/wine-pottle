import{S as t,i as e,s as r,j as n,m as a,o,v as s,r as l,w as i,e as c,k as u,c as d,a as f,n as p,d as h,b as m,f as g,E as $,t as v,g as y,O as w,W as j,u as x,Q as b,U as E,H as U,h as _,B as I}from"../../../../chunks/vendor-494dde6f.js";import{s as k}from"../../../../chunks/stores-3eb657b5.js";import{B as D}from"../../../../chunks/Button-fbe70615.js";import{E as P}from"../../../../chunks/ErrorAlert-7d139505.js";function B(t,e,r){const n=t.slice();return n[10]=e[r],n}function O(t){let e;return{c(){e=v("Upload")},l(t){e=y(t,"Upload")},m(t,r){g(t,e,r)},d(t){t&&h(e)}}}function G(t){let e,r;return e=new P({props:{$$slots:{default:[L]},$$scope:{ctx:t}}}),{c(){n(e.$$.fragment)},l(t){a(e.$$.fragment,t)},m(t,n){o(e,t,n),r=!0},p(t,r){const n={};8193&r&&(n.$$scope={dirty:r,ctx:t}),e.$set(n)},i(t){r||(s(e.$$.fragment,t),r=!0)},o(t){l(e.$$.fragment,t),r=!1},d(t){i(e,t)}}}function L(t){let e;return{c(){e=v(t[0])},l(r){e=y(r,t[0])},m(t,r){g(t,e,r)},p(t,r){1&r&&_(e,t[0])},d(t){t&&h(e)}}}function R(t){let e,r,n,a,o;return{c(){e=c("picture"),r=c("img"),o=u(),this.h()},l(t){e=d(t,"PICTURE",{});var n=f(e);r=d(n,"IMG",{src:!0,alt:!0,loading:!0}),o=p(n),n.forEach(h),this.h()},h(){r.src!==(n=t[10].secure_url)&&m(r,"src",n),m(r,"alt",a=t[10].public_id),m(r,"loading","lazy")},m(t,n){g(t,e,n),$(e,r),$(e,o)},p(t,e){4&e&&r.src!==(n=t[10].secure_url)&&m(r,"src",n),4&e&&a!==(a=t[10].public_id)&&m(r,"alt",a)},d(t){t&&h(e)}}}function F(t){let e,r,U,_,k,P,L,F,M,V,A,C,H,N,T,W,q,z,Q,S,J;T=new D({props:{type:"submit",$$slots:{default:[O]},$$scope:{ctx:t}}});let K=t[0]&&G(t),X=t[2],Y=[];for(let n=0;n<X.length;n+=1)Y[n]=R(B(t,X,n));return{c(){e=c("h1"),r=v("Gallery"),U=u(),_=c("form"),k=c("label"),P=v("Upload Image"),L=u(),F=c("input"),M=u(),V=c("div"),A=c("img"),H=u(),N=c("div"),n(T.$$.fragment),W=u(),K&&K.c(),q=u(),z=c("div");for(let t=0;t<Y.length;t+=1)Y[t].c();this.h()},l(t){e=d(t,"H1",{});var n=f(e);r=y(n,"Gallery"),n.forEach(h),U=p(t),_=d(t,"FORM",{id:!0});var o=f(_);k=d(o,"LABEL",{for:!0});var s=f(k);P=y(s,"Upload Image"),s.forEach(h),L=p(o),F=d(o,"INPUT",{type:!0,id:!0,accept:!0}),M=p(o),V=d(o,"DIV",{id:!0});var l=f(V);A=d(l,"IMG",{src:!0,alt:!0,height:!0}),l.forEach(h),H=p(o),N=d(o,"DIV",{id:!0});var i=f(N);a(T.$$.fragment,i),i.forEach(h),o.forEach(h),W=p(t),K&&K.l(t),q=p(t),z=d(t,"DIV",{id:!0,class:!0});var c=f(z);for(let e=0;e<Y.length;e+=1)Y[e].l(c);c.forEach(h),this.h()},h(){m(k,"for","imageUpload"),m(F,"type","file"),m(F,"id","imageUpload"),m(F,"accept","image/*"),A.src!==(C=t[3])&&m(A,"src",C),m(A,"alt","Preview"),m(A,"height","100px"),m(V,"id","preview"),m(N,"id","uploadButtonContainer"),m(_,"id","uploadForm"),m(z,"id","gallery"),m(z,"class","svelte-3xdcj1")},m(n,a){g(n,e,a),$(e,r),g(n,U,a),g(n,_,a),$(_,k),$(k,P),$(_,L),$(_,F),$(_,M),$(_,V),$(V,A),$(_,H),$(_,N),o(T,N,null),g(n,W,a),K&&K.m(n,a),g(n,q,a),g(n,z,a);for(let t=0;t<Y.length;t+=1)Y[t].m(z,null);Q=!0,S||(J=[w(F,"change",t[7]),w(_,"submit",j(t[4]))],S=!0)},p(t,[e]){(!Q||8&e&&A.src!==(C=t[3]))&&m(A,"src",C);const r={};if(8192&e&&(r.$$scope={dirty:e,ctx:t}),T.$set(r),t[0]?K?(K.p(t,e),1&e&&s(K,1)):(K=G(t),K.c(),s(K,1),K.m(q.parentNode,q)):K&&(I(),l(K,1,1,(()=>{K=null})),x()),4&e){let r;for(X=t[2],r=0;r<X.length;r+=1){const n=B(t,X,r);Y[r]?Y[r].p(n,e):(Y[r]=R(n),Y[r].c(),Y[r].m(z,null))}for(;r<Y.length;r+=1)Y[r].d(1);Y.length=X.length}},i(t){Q||(s(T.$$.fragment,t),s(K),Q=!0)},o(t){l(T.$$.fragment,t),l(K),Q=!1},d(t){t&&h(e),t&&h(U),t&&h(_),i(T),t&&h(W),K&&K.d(t),t&&h(q),t&&h(z),b(Y,t),S=!1,E(J)}}}var M=function(t,e,r,n){return new(r||(r=Promise))((function(a,o){function s(t){try{i(n.next(t))}catch(e){o(e)}}function l(t){try{i(n.throw(t))}catch(e){o(e)}}function i(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,l)}i((n=n.apply(t,e||[])).next())}))};const V=({fetch:t,session:e})=>M(void 0,void 0,void 0,(function*(){try{const r=yield t(`/images/venues/${e.venue.route}.json`);if(!r.ok){throw(yield r.json()).errors}return{props:{gallery:yield r.json()}}}catch(r){return{props:{err:r}}}}));function A(t,e,r){let n,a,o;U(t,k,(t=>r(8,o=t)));var s=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(a,o){function s(t){try{i(n.next(t))}catch(e){o(e)}}function l(t){try{i(n.throw(t))}catch(e){o(e)}}function i(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,l)}i((n=n.apply(t,e||[])).next())}))};let l,{err:i}=e,{gallery:c}=e,u=(null==c?void 0:c.resources.map((t=>t)))||[];return t.$$set=t=>{"err"in t&&r(0,i=t.err),"gallery"in t&&r(5,c=t.gallery)},t.$$.update=()=>{64&t.$$.dirty&&r(2,n=u.sort(((t,e)=>new Date(e.created_at).valueOf()-new Date(t.created_at).valueOf()))),2&t.$$.dirty&&r(3,a=l&&l.length>0?URL.createObjectURL(l[0]):"")},[i,l,n,a,function(){return s(this,void 0,void 0,(function*(){try{let t=new FormData;t.append("file",l.item(0)),t.append("upload_preset","wine-pottle"),t.append("folder","WinePottle"),t.append("tags",o.venue.route);let e=yield fetch("https://api.cloudinary.com/v1_1/dkj7bctqg/image/upload",{method:"post",body:t});if(!e.ok)throw yield e.json();let n=yield e.json();r(6,u=[...u,n])}catch(t){r(0,i=t)}}))},c,u,function(){l=this.files,r(1,l)}]}export default class extends t{constructor(t){super(),e(this,t,A,F,r,{err:0,gallery:5})}}export{V as load};
