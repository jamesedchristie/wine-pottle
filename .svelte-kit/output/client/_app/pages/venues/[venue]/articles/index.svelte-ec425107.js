import{S as e,i as t,s as r,j as s,m as n,o as i,v as a,r as o,w as c,e as l,k as f,t as h,c as u,a as d,d as p,n as v,g as m,b as $,f as w,E as g,h as y,T as E,O as j,W as I,u as x,Q as b,U as k,H as P,M as A,B as T}from"../../../../chunks/vendor-494dde6f.js";import{s as N}from"../../../../chunks/utils-ccc08853.js";import{B as O}from"../../../../chunks/Button-fbe70615.js";import{E as S}from"../../../../chunks/ErrorAlert-7d139505.js";import{s as U}from"../../../../chunks/stores-3eb657b5.js";function V(e,t,r){const s=e.slice();return s[8]=t[r],s}function B(e){let t,r;return t=new S({props:{$$slots:{default:[C]},$$scope:{ctx:e}}}),{c(){s(t.$$.fragment)},l(e){n(t.$$.fragment,e)},m(e,s){i(t,e,s),r=!0},p(e,r){const s={};2049&r&&(s.$$scope={dirty:r,ctx:e}),t.$set(s)},i(e){r||(a(t.$$.fragment,e),r=!0)},o(e){o(t.$$.fragment,e),r=!1},d(e){c(t,e)}}}function C(e){let t;return{c(){t=h(e[0])},l(r){t=m(r,e[0])},m(e,r){w(e,t,r)},p(e,r){1&r&&y(t,e[0])},d(e){e&&p(t)}}}function D(e){let t;return{c(){t=h("Post")},l(e){t=m(e,"Post")},m(e,r){w(e,t,r)},d(e){e&&p(t)}}}function L(e){let t,r,s,n,i,a,o,c,E,j,I,x,b,k,P,A,T,N=e[8].preview.title+"",O=e[8].preview.description+"";return{c(){t=l("article"),r=l("div"),s=l("img"),a=f(),o=l("div"),c=l("h4"),E=h(N),j=f(),I=l("p"),x=h(O),b=f(),k=l("a"),P=h("Visit"),T=f(),this.h()},l(e){t=u(e,"ARTICLE",{class:!0});var n=d(t);r=u(n,"DIV",{class:!0});var i=d(r);s=u(i,"IMG",{src:!0,alt:!0,width:!0}),i.forEach(p),a=v(n),o=u(n,"DIV",{class:!0});var l=d(o);c=u(l,"H4",{});var f=d(c);E=m(f,N),f.forEach(p),j=v(l),I=u(l,"P",{});var h=d(I);x=m(h,O),h.forEach(p),b=v(l),k=u(l,"A",{href:!0,target:!0});var $=d(k);P=m($,"Visit"),$.forEach(p),l.forEach(p),T=v(n),n.forEach(p),this.h()},h(){var a,c;s.src!==(n=(null==(c=null==(a=e[8].preview)?void 0:a.images)?void 0:c.length)>0?e[8].preview.images[0]:"")&&$(s,"src",n),$(s,"alt",i=e[8].preview.title),$(s,"width","100"),$(r,"class","articleImage svelte-1eumhpq"),$(k,"href",A=e[8].href),$(k,"target","_blank"),$(o,"class","articleInfo"),$(t,"class","svelte-1eumhpq")},m(e,n){w(e,t,n),g(t,r),g(r,s),g(t,a),g(t,o),g(o,c),g(c,E),g(o,j),g(o,I),g(I,x),g(o,b),g(o,k),g(k,P),g(t,T)},p(e,t){var r,a;2&t&&s.src!==(n=(null==(a=null==(r=e[8].preview)?void 0:r.images)?void 0:a.length)>0?e[8].preview.images[0]:"")&&$(s,"src",n),2&t&&i!==(i=e[8].preview.title)&&$(s,"alt",i),2&t&&N!==(N=e[8].preview.title+"")&&y(E,N),2&t&&O!==(O=e[8].preview.description+"")&&y(x,O),2&t&&A!==(A=e[8].href)&&$(k,"href",A)},d(e){e&&p(t)}}}function q(e){let t,r,y,P,A,S,U,C,q,R,H,M,_,F,J,G,Q,W,z,K=e[0]&&B(e);F=new O({props:{variant:"primary",type:"submit",$$slots:{default:[D]},$$scope:{ctx:e}}});let X=N(e[1]),Y=[];for(let s=0;s<X.length;s+=1)Y[s]=L(V(e,X,s));return{c(){t=l("h1"),r=h("Articles"),y=f(),K&&K.c(),P=f(),A=l("section"),S=l("form"),U=l("div"),C=l("label"),q=h("URL"),R=f(),H=l("input"),M=f(),_=l("div"),s(F.$$.fragment),J=f(),G=l("section");for(let e=0;e<Y.length;e+=1)Y[e].c();this.h()},l(e){t=u(e,"H1",{});var s=d(t);r=m(s,"Articles"),s.forEach(p),y=v(e),K&&K.l(e),P=v(e),A=u(e,"SECTION",{id:!0,class:!0});var i=d(A);S=u(i,"FORM",{id:!0});var a=d(S);U=u(a,"DIV",{id:!0});var o=d(U);C=u(o,"LABEL",{for:!0});var c=d(C);q=m(c,"URL"),c.forEach(p),R=v(o),H=u(o,"INPUT",{id:!0,type:!0,placeholder:!0}),o.forEach(p),M=v(a),_=u(a,"DIV",{id:!0});var l=d(_);n(F.$$.fragment,l),l.forEach(p),a.forEach(p),i.forEach(p),J=v(e),G=u(e,"SECTION",{id:!0,class:!0});var f=d(G);for(let t=0;t<Y.length;t+=1)Y[t].l(f);f.forEach(p),this.h()},h(){$(C,"for","articleUrl"),$(H,"id","articleUrl"),$(H,"type","text"),$(H,"placeholder","Paste the address of the article..."),$(U,"id","titleSection"),$(_,"id","newPostButtons"),$(S,"id","newPostForm"),$(A,"id","newArticle"),$(A,"class","svelte-1eumhpq"),$(G,"id","feed"),$(G,"class","svelte-1eumhpq")},m(s,n){w(s,t,n),g(t,r),w(s,y,n),K&&K.m(s,n),w(s,P,n),w(s,A,n),g(A,S),g(S,U),g(U,C),g(C,q),g(U,R),g(U,H),E(H,e[2]),g(S,M),g(S,_),i(F,_,null),w(s,J,n),w(s,G,n);for(let e=0;e<Y.length;e+=1)Y[e].m(G,null);Q=!0,W||(z=[j(H,"input",e[4]),j(S,"submit",I(e[3]))],W=!0)},p(e,[t]){e[0]?K?(K.p(e,t),1&t&&a(K,1)):(K=B(e),K.c(),a(K,1),K.m(P.parentNode,P)):K&&(T(),o(K,1,1,(()=>{K=null})),x()),4&t&&H.value!==e[2]&&E(H,e[2]);const r={};if(2048&t&&(r.$$scope={dirty:t,ctx:e}),F.$set(r),2&t){let r;for(X=N(e[1]),r=0;r<X.length;r+=1){const s=V(e,X,r);Y[r]?Y[r].p(s,t):(Y[r]=L(s),Y[r].c(),Y[r].m(G,null))}for(;r<Y.length;r+=1)Y[r].d(1);Y.length=X.length}},i(e){Q||(a(K),a(F.$$.fragment,e),Q=!0)},o(e){o(K),o(F.$$.fragment,e),Q=!1},d(e){e&&p(t),e&&p(y),K&&K.d(e),e&&p(P),e&&p(A),c(F),e&&p(J),e&&p(G),b(Y,e),W=!1,k(z)}}}var R=function(e,t,r,s){return new(r||(r=Promise))((function(n,i){function a(e){try{c(s.next(e))}catch(t){i(t)}}function o(e){try{c(s.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};const H=({fetch:e,session:t})=>R(void 0,void 0,void 0,(function*(){try{const r=yield e("/articles.json?venueId="+t.venue.id);if(!r.ok){throw(yield r.json()).errors}return{props:{articles:yield r.json()}}}catch(r){return{props:{err:r}}}}));function M(e,t,r){let s;P(e,U,(e=>r(5,s=e)));var n=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,i){function a(e){try{c(s.next(e))}catch(t){i(t)}}function o(e){try{c(s.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};let{err:i}=t;A("store");let{articles:a=[]}=t,o="";return e.$$set=e=>{"err"in e&&r(0,i=e.err),"articles"in e&&r(1,a=e.articles)},[i,a,o,function(){return n(this,void 0,void 0,(function*(){try{const e={userId:s.user.id,venueId:s.venue.id,href:o,datetime:new Date},t=yield fetch("/articles/preview",{method:"post",credentials:"include",headers:{"Content-Type":"application/json "},body:JSON.stringify({url:o})});if(!t.ok){throw(yield t.json()).errors}e.preview=yield t.json(),r(1,a=[...a,e]),fetch("/articles.json",{method:"post",credentials:"include",headers:{"Content-Type":"application/json "},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{if(e.errors)throw e.errors;console.log(e)}))}catch(e){r(0,i=e)}}))},function(){o=this.value,r(2,o)}]}export default class extends e{constructor(e){super(),t(this,e,M,q,r,{err:0,articles:1})}}export{H as load};
