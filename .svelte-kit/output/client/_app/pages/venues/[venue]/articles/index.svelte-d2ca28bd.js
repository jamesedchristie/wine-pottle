import{S as e,i as t,s as r,j as s,m as n,o as i,v as a,r as o,w as c,e as l,k as f,t as h,c as d,a as u,d as p,n as v,g as m,b as w,f as g,D as y,h as $,O as E,L as j,R as I,u as x,N as k,P,G as b,B as A}from"../../../../chunks/vendor-197173f7.js";import{a as N}from"../../../../chunks/firebase-d84582fa.js";import{s as D}from"../../../../chunks/utils-ccc08853.js";import{B as O}from"../../../../chunks/Button-80d06a7e.js";import{E as S}from"../../../../chunks/ErrorAlert-f76ade2a.js";import{s as T}from"../../../../chunks/stores-23449eec.js";/* empty css                                                                  */function C(e,t,r){const s=e.slice();return s[7]=t[r],s}function L(e){let t,r;return t=new S({props:{$$slots:{default:[V]},$$scope:{ctx:e}}}),{c(){s(t.$$.fragment)},l(e){n(t.$$.fragment,e)},m(e,s){i(t,e,s),r=!0},p(e,r){const s={};1025&r&&(s.$$scope={dirty:r,ctx:e}),t.$set(s)},i(e){r||(a(t.$$.fragment,e),r=!0)},o(e){o(t.$$.fragment,e),r=!1},d(e){c(t,e)}}}function V(e){let t;return{c(){t=h(e[0])},l(r){t=m(r,e[0])},m(e,r){g(e,t,r)},p(e,r){1&r&&$(t,e[0])},d(e){e&&p(t)}}}function B(e){let t;return{c(){t=h("Post")},l(e){t=m(e,"Post")},m(e,r){g(e,t,r)},d(e){e&&p(t)}}}function R(e){let t,r,s,n,i,a,o,c,E,j,I,x,k,P,b,A,N,D=e[7].preview.title+"",O=e[7].preview.description+"";return{c(){t=l("article"),r=l("div"),s=l("img"),a=f(),o=l("div"),c=l("h4"),E=h(D),j=f(),I=l("p"),x=h(O),k=f(),P=l("a"),b=h("Visit"),N=f(),this.h()},l(e){t=d(e,"ARTICLE",{class:!0});var n=u(t);r=d(n,"DIV",{class:!0});var i=u(r);s=d(i,"IMG",{src:!0,alt:!0,width:!0}),i.forEach(p),a=v(n),o=d(n,"DIV",{class:!0});var l=u(o);c=d(l,"H4",{});var f=u(c);E=m(f,D),f.forEach(p),j=v(l),I=d(l,"P",{});var h=u(I);x=m(h,O),h.forEach(p),k=v(l),P=d(l,"A",{href:!0,target:!0});var w=u(P);b=m(w,"Visit"),w.forEach(p),l.forEach(p),N=v(n),n.forEach(p),this.h()},h(){var a,c;s.src!==(n=(null==(c=null==(a=e[7].preview)?void 0:a.images)?void 0:c.length)>0?e[7].preview.images[0]:"")&&w(s,"src",n),w(s,"alt",i=e[7].preview.title),w(s,"width","100"),w(r,"class","articleImage svelte-1eumhpq"),w(P,"href",A=e[7].href),w(P,"target","_blank"),w(o,"class","articleInfo"),w(t,"class","svelte-1eumhpq")},m(e,n){g(e,t,n),y(t,r),y(r,s),y(t,a),y(t,o),y(o,c),y(c,E),y(o,j),y(o,I),y(I,x),y(o,k),y(o,P),y(P,b),y(t,N)},p(e,t){var r,a;2&t&&s.src!==(n=(null==(a=null==(r=e[7].preview)?void 0:r.images)?void 0:a.length)>0?e[7].preview.images[0]:"")&&w(s,"src",n),2&t&&i!==(i=e[7].preview.title)&&w(s,"alt",i),2&t&&D!==(D=e[7].preview.title+"")&&$(E,D),2&t&&O!==(O=e[7].preview.description+"")&&$(x,O),2&t&&A!==(A=e[7].href)&&w(P,"href",A)},d(e){e&&p(t)}}}function U(e){let t,r,$,b,N,S,T,V,U,q,_,J,F,G,H,M,z,K,Q,W=e[0]&&L(e);G=new O({props:{variant:"primary",type:"submit",$$slots:{default:[B]},$$scope:{ctx:e}}});let X=D(e[1]),Y=[];for(let s=0;s<X.length;s+=1)Y[s]=R(C(e,X,s));return{c(){t=l("h1"),r=h("Articles"),$=f(),W&&W.c(),b=f(),N=l("section"),S=l("form"),T=l("div"),V=l("label"),U=h("URL"),q=f(),_=l("input"),J=f(),F=l("div"),s(G.$$.fragment),H=f(),M=l("section");for(let e=0;e<Y.length;e+=1)Y[e].c();this.h()},l(e){t=d(e,"H1",{});var s=u(t);r=m(s,"Articles"),s.forEach(p),$=v(e),W&&W.l(e),b=v(e),N=d(e,"SECTION",{id:!0,class:!0});var i=u(N);S=d(i,"FORM",{id:!0});var a=u(S);T=d(a,"DIV",{id:!0});var o=u(T);V=d(o,"LABEL",{for:!0});var c=u(V);U=m(c,"URL"),c.forEach(p),q=v(o),_=d(o,"INPUT",{id:!0,type:!0,placeholder:!0}),o.forEach(p),J=v(a),F=d(a,"DIV",{id:!0});var l=u(F);n(G.$$.fragment,l),l.forEach(p),a.forEach(p),i.forEach(p),H=v(e),M=d(e,"SECTION",{id:!0,class:!0});var f=u(M);for(let t=0;t<Y.length;t+=1)Y[t].l(f);f.forEach(p),this.h()},h(){w(V,"for","articleUrl"),w(_,"id","articleUrl"),w(_,"type","text"),w(_,"placeholder","Paste the address of the article..."),w(T,"id","titleSection"),w(F,"id","newPostButtons"),w(S,"id","newPostForm"),w(N,"id","newArticle"),w(N,"class","svelte-1eumhpq"),w(M,"id","feed"),w(M,"class","svelte-1eumhpq")},m(s,n){g(s,t,n),y(t,r),g(s,$,n),W&&W.m(s,n),g(s,b,n),g(s,N,n),y(N,S),y(S,T),y(T,V),y(V,U),y(T,q),y(T,_),E(_,e[2]),y(S,J),y(S,F),i(G,F,null),g(s,H,n),g(s,M,n);for(let e=0;e<Y.length;e+=1)Y[e].m(M,null);z=!0,K||(Q=[j(_,"input",e[4]),j(S,"submit",I(e[3]))],K=!0)},p(e,[t]){e[0]?W?(W.p(e,t),1&t&&a(W,1)):(W=L(e),W.c(),a(W,1),W.m(b.parentNode,b)):W&&(A(),o(W,1,1,(()=>{W=null})),x()),4&t&&_.value!==e[2]&&E(_,e[2]);const r={};if(1024&t&&(r.$$scope={dirty:t,ctx:e}),G.$set(r),2&t){let r;for(X=D(e[1]),r=0;r<X.length;r+=1){const s=C(e,X,r);Y[r]?Y[r].p(s,t):(Y[r]=R(s),Y[r].c(),Y[r].m(M,null))}for(;r<Y.length;r+=1)Y[r].d(1);Y.length=X.length}},i(e){z||(a(W),a(G.$$.fragment,e),z=!0)},o(e){o(W),o(G.$$.fragment,e),z=!1},d(e){e&&p(t),e&&p($),W&&W.d(e),e&&p(b),e&&p(N),c(G),e&&p(H),e&&p(M),k(Y,e),K=!1,P(Q)}}}var q=function(e,t,r,s){return new(r||(r=Promise))((function(n,i){function a(e){try{c(s.next(e))}catch(t){i(t)}}function o(e){try{c(s.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};const _=({fetch:e,session:t})=>q(void 0,void 0,void 0,(function*(){try{let r=[];const s=(yield N.where("venueId","==",t.venue.id).get()).docs;for(let t of s){let s=yield t.data();s.datetime=new Date(s.datetime);const n=yield e("articles/preview",{method:"post",credentials:"include",headers:{"Content-Type":"application/json "},body:JSON.stringify({url:s.href})});if(!n.ok){throw(yield n.json()).errors}s.preview=yield n.json(),r.push(s)}return{props:{articles:r}}}catch(r){return{props:{err:r}}}}));function J(e,t,r){let s;b(e,T,(e=>r(5,s=e)));var n=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,i){function a(e){try{c(s.next(e))}catch(t){i(t)}}function o(e){try{c(s.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};let{err:i}=t,{articles:a}=t,o="";return e.$$set=e=>{"err"in e&&r(0,i=e.err),"articles"in e&&r(1,a=e.articles)},[i,a,o,function(){return n(this,void 0,void 0,(function*(){try{const e={userId:s.user.id,venueId:s.venue.id,href:o,datetime:new Date},t=yield fetch("articles/preview",{method:"post",credentials:"include",headers:{"Content-Type":"application/json "},body:JSON.stringify({url:o})});if(!t.ok){throw(yield t.json()).errors}e.preview=yield t.json(),r(1,a=[...a,e]),fetch("articles.json",{method:"post",credentials:"include",headers:{"Content-Type":"application/json "},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{if(e.errors)throw e.errors;console.log(e)}))}catch(e){r(0,i=e)}}))},function(){o=this.value,r(2,o)}]}export default class extends e{constructor(e){super(),t(this,e,J,U,r,{err:0,articles:1})}}export{_ as load};
