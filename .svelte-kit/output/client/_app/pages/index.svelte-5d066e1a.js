import{S as e,i as n,s as t,j as r,m as s,o as l,K as o,v as u,r as a,w as h,e as c,t as i,k as f,l as d,c as v,a as m,g,d as p,n as E,b as $,f as V,E as y,h as A,H as j,Q as I}from"../chunks/vendor-494dde6f.js";import{E as w}from"../chunks/ErrorAlert-7d139505.js";import{s as P}from"../chunks/stores-3eb657b5.js";function x(e,n,t){const r=e.slice();return r[6]=n[t],r}function C(e,n,t){const r=e.slice();return r[6]=n[t],r}function b(e){let n,t,r,s,l,o,u,a,h,j,w=e[0].user.name+"",P=e[2].length>0&&function(e){let n,t,r,s,l=e[2],o=[];for(let u=0;u<l.length;u+=1)o[u]=k(C(e,l,u));return{c(){n=c("h2"),t=i("Your Venues"),r=f(),s=c("div");for(let e=0;e<o.length;e+=1)o[e].c();this.h()},l(e){n=v(e,"H2",{});var l=m(n);t=g(l,"Your Venues"),l.forEach(p),r=E(e),s=v(e,"DIV",{id:!0});var u=m(s);for(let n=0;n<o.length;n+=1)o[n].l(u);u.forEach(p),this.h()},h(){$(s,"id","userVenues")},m(e,l){V(e,n,l),y(n,t),V(e,r,l),V(e,s,l);for(let n=0;n<o.length;n+=1)o[n].m(s,null)},p(e,n){if(4&n){let t;for(l=e[2],t=0;t<l.length;t+=1){const r=C(e,l,t);o[t]?o[t].p(r,n):(o[t]=k(r),o[t].c(),o[t].m(s,null))}for(;t<o.length;t+=1)o[t].d(1);o.length=l.length}},d(e){e&&p(n),e&&p(r),e&&p(s),I(o,e)}}}(e),b=e[3].length>0&&function(e){let n,t,r,s,l=e[3],o=[];for(let u=0;u<l.length;u+=1)o[u]=H(x(e,l,u));return{c(){n=c("h2"),t=i("All Venues"),r=f(),s=c("div");for(let e=0;e<o.length;e+=1)o[e].c();this.h()},l(e){n=v(e,"H2",{});var l=m(n);t=g(l,"All Venues"),l.forEach(p),r=E(e),s=v(e,"DIV",{id:!0});var u=m(s);for(let n=0;n<o.length;n+=1)o[n].l(u);u.forEach(p),this.h()},h(){$(s,"id","allVenues")},m(e,l){V(e,n,l),y(n,t),V(e,r,l),V(e,s,l);for(let n=0;n<o.length;n+=1)o[n].m(s,null)},p(e,n){if(8&n){let t;for(l=e[3],t=0;t<l.length;t+=1){const r=x(e,l,t);o[t]?o[t].p(r,n):(o[t]=H(r),o[t].c(),o[t].m(s,null))}for(;t<o.length;t+=1)o[t].d(1);o.length=l.length}},d(e){e&&p(n),e&&p(r),e&&p(s),I(o,e)}}}(e);return{c(){n=c("p"),t=i("Welcome "),r=i(w),s=f(),P&&P.c(),l=f(),o=c("div"),u=c("a"),a=i("Create A Venue Channel"),h=f(),b&&b.c(),j=d(),this.h()},l(e){n=v(e,"P",{});var c=m(n);t=g(c,"Welcome "),r=g(c,w),c.forEach(p),s=E(e),P&&P.l(e),l=E(e),o=v(e,"DIV",{id:!0,class:!0});var i=m(o);u=v(i,"A",{href:!0});var f=m(u);a=g(f,"Create A Venue Channel"),f.forEach(p),i.forEach(p),h=E(e),b&&b.l(e),j=d(),this.h()},h(){$(u,"href","/venues/create"),$(o,"id","newVenueButton"),$(o,"class","svelte-y3qh0l")},m(e,c){V(e,n,c),y(n,t),y(n,r),V(e,s,c),P&&P.m(e,c),V(e,l,c),V(e,o,c),y(o,u),y(u,a),V(e,h,c),b&&b.m(e,c),V(e,j,c)},p(e,n){1&n&&w!==(w=e[0].user.name+"")&&A(r,w),e[2].length>0&&P.p(e,n),e[3].length>0&&b.p(e,n)},d(e){e&&p(n),e&&p(s),P&&P.d(e),e&&p(l),e&&p(o),e&&p(h),b&&b.d(e),e&&p(j)}}}function k(e){let n,t,r,s,l=e[6].name+"";return{c(){n=c("p"),t=c("a"),r=i(l),s=f(),this.h()},l(e){n=v(e,"P",{});var o=m(n);t=v(o,"A",{href:!0});var u=m(t);r=g(u,l),u.forEach(p),s=E(o),o.forEach(p),this.h()},h(){$(t,"href",`venues/enter?venueId=${e[6].id}&route=${e[6].route}`)},m(e,l){V(e,n,l),y(n,t),y(t,r),y(n,s)},p:o,d(e){e&&p(n)}}}function H(e){let n,t,r,s,l=e[6].name+"";return{c(){n=c("p"),t=c("a"),r=i(l),s=f(),this.h()},l(e){n=v(e,"P",{});var o=m(n);t=v(o,"A",{href:!0});var u=m(t);r=g(u,l),u.forEach(p),s=E(o),o.forEach(p),this.h()},h(){$(t,"href",`/venues/join?venue=${e[6].id}`)},m(e,l){V(e,n,l),y(n,t),y(t,r),y(n,s)},p:o,d(e){e&&p(n)}}}function W(e){let n,t,d,$,A,j,I=e[1]&&function(e){let n,t;return n=new w({props:{message:e[1]}}),{c(){r(n.$$.fragment)},l(e){s(n.$$.fragment,e)},m(e,r){l(n,e,r),t=!0},p:o,i(e){t||(u(n.$$.fragment,e),t=!0)},o(e){a(n.$$.fragment,e),t=!1},d(e){h(n,e)}}}(e),P=e[0].user&&b(e);return{c(){n=c("h1"),t=i("Wine Pottle"),d=f(),I&&I.c(),$=f(),A=c("section"),P&&P.c()},l(e){n=v(e,"H1",{});var r=m(n);t=g(r,"Wine Pottle"),r.forEach(p),d=E(e),I&&I.l(e),$=E(e),A=v(e,"SECTION",{});var s=m(A);P&&P.l(s),s.forEach(p)},m(e,r){V(e,n,r),y(n,t),V(e,d,r),I&&I.m(e,r),V(e,$,r),V(e,A,r),P&&P.m(A,null),j=!0},p(e,[n]){e[1]&&I.p(e,n),e[0].user?P?P.p(e,n):(P=b(e),P.c(),P.m(A,null)):P&&(P.d(1),P=null)},i(e){j||(u(I),j=!0)},o(e){a(I),j=!1},d(e){e&&p(n),e&&p(d),I&&I.d(e),e&&p($),e&&p(A),P&&P.d()}}}var D=function(e,n,t,r){return new(t||(t=Promise))((function(s,l){function o(e){try{a(r.next(e))}catch(n){l(n)}}function u(e){try{a(r.throw(e))}catch(n){l(n)}}function a(e){var n;e.done?s(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,u)}a((r=r.apply(e,n||[])).next())}))};const S=({session:e,fetch:n})=>D(void 0,void 0,void 0,(function*(){if(!e.user)return{redirect:"login",status:302};e.venue&&(yield n("/venues/leave",{method:"post"}));try{const t=yield n(`venues.json?userId=${e.user.id}`),r=yield t.json();return{props:{venues:r.venues,uvms:r.userVenueMemberships}}}catch(t){console.log(t)}}));function Y(e,n,t){let r;j(e,P,(e=>t(0,r=e)));let{venues:s}=n,{uvms:l}=n;const o=l.length>0?null==s?void 0:s.filter((e=>l.some((n=>(null==n?void 0:n.venueId)===e.id)))):[],u=o.length>0?null==s?void 0:s.filter((e=>!o.includes(e))):s;return e.$$set=e=>{"venues"in e&&t(4,s=e.venues),"uvms"in e&&t(5,l=e.uvms)},[r,undefined,o,u,s,l]}export default class extends e{constructor(e){super(),n(this,e,Y,W,t,{venues:4,uvms:5})}}export{S as load};
