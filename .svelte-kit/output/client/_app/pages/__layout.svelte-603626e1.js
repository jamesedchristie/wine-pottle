import{D as s,S as e,i as t,s as a,e as n,t as o,c as r,a as i,g as c,d as l,f as u,E as f,F as h,k as p,n as d,b as m,r as v,u as $,v as g,G as b,H as E,x as w,z as j,B as x,I as y,J as I,R as k,K as P,j as A,m as L,L as N,o as B,h as D,w as R,C as K}from"../chunks/vendor-494dde6f.js";import{g as _}from"../chunks/navigation-20968cc5.js";import{s as F}from"../chunks/stores-3eb657b5.js";import{B as J}from"../chunks/Button-fbe70615.js";import{l as S}from"../chunks/stores-c6b7a22b.js";import"../chunks/singletons-bb9012b7.js";s.config();var V={apiKey:process.env.FIREBASE_API_KEY,authDomain:"winepottle.firebaseapp.com",projectId:"winepottle",storageBucket:"winepottle.appspot.com",messagingSenderId:"118092403337",appId:"1:118092403337:web:1cf5c3e510b9b19b91ac58",measurementId:"G-6KTPW3P72Y"};function W(s){let e,t;return{c(){e=n("p"),t=o("Loading...")},l(s){e=r(s,"P",{});var a=i(e);t=c(a,"Loading..."),a.forEach(l)},m(s,a){u(s,e,a),f(e,t)},d(s){s&&l(e)}}}function G(s){let e,t;return{c(){e=n("a"),t=o("Login"),this.h()},l(s){e=r(s,"A",{href:!0});var a=i(e);t=c(a,"Login"),a.forEach(l),this.h()},h(){m(e,"href","/login")},m(s,a){u(s,e,a),f(e,t)},p:P,i:P,o:P,d(s){s&&l(e)}}}function H(s){let e,t,a,h,$,b,E=s[0].user.name+"";return $=new J({props:{variant:"primary",$$slots:{default:[O]},$$scope:{ctx:s}}}),$.$on("click",s[2]),{c(){e=n("a"),t=o(E),h=p(),A($.$$.fragment),this.h()},l(s){e=r(s,"A",{href:!0,style:!0});var a=i(e);t=c(a,E),a.forEach(l),h=d(s),L($.$$.fragment,s),this.h()},h(){m(e,"href",a=`/profile/${s[0].user.name}`),N(e,"margin","0px 20px")},m(s,a){u(s,e,a),f(e,t),u(s,h,a),B($,s,a),b=!0},p(s,n){(!b||1&n)&&E!==(E=s[0].user.name+"")&&D(t,E),(!b||1&n&&a!==(a=`/profile/${s[0].user.name}`))&&m(e,"href",a);const o={};16&n&&(o.$$scope={dirty:n,ctx:s}),$.$set(o)},i(s){b||(g($.$$.fragment,s),b=!0)},o(s){v($.$$.fragment,s),b=!1},d(s){s&&l(e),s&&l(h),R($,s)}}}function O(s){let e;return{c(){e=o("Logout")},l(s){e=c(s,"Logout")},m(s,t){u(s,e,t)},d(s){s&&l(e)}}}function T(s){let e,t,a,E,w,j,y,I,k,P,A,L,N,B,D,R,K,_=s[1]&&W();const F=[H,G],J=[];function S(s,e){return s[0].user?0:1}k=S(s),P=J[k]=F[k](s);const V=s[3].default,O=h(V,s,s[4],null);return{c(){e=n("header"),t=n("nav"),a=n("a"),E=o("Wine Pottle"),w=p(),j=n("div"),_&&_.c(),y=p(),I=n("div"),P.c(),A=p(),L=n("main"),O&&O.c(),N=p(),B=n("footer"),D=n("p"),R=o("© Jasmin Natterer 2021"),this.h()},l(s){e=r(s,"HEADER",{class:!0});var n=i(e);t=r(n,"NAV",{id:!0,class:!0});var o=i(t);a=r(o,"A",{id:!0,href:!0});var u=i(a);E=c(u,"Wine Pottle"),u.forEach(l),w=d(o),j=r(o,"DIV",{});var f=i(j);_&&_.l(f),f.forEach(l),y=d(o),I=r(o,"DIV",{id:!0});var h=i(I);P.l(h),h.forEach(l),o.forEach(l),n.forEach(l),A=d(s),L=r(s,"MAIN",{class:!0});var p=i(L);O&&O.l(p),p.forEach(l),N=d(s),B=r(s,"FOOTER",{class:!0});var m=i(B);D=r(m,"P",{});var v=i(D);R=c(v,"© Jasmin Natterer 2021"),v.forEach(l),m.forEach(l),this.h()},h(){m(a,"id","winePottleLogo"),m(a,"href","/"),m(I,"id","topNavRight"),m(t,"id","topNav"),m(t,"class","svelte-1nj3e00"),m(e,"class","svelte-1nj3e00"),m(L,"class","svelte-1nj3e00"),m(B,"class","svelte-1nj3e00")},m(s,n){u(s,e,n),f(e,t),f(t,a),f(a,E),f(t,w),f(t,j),_&&_.m(j,null),f(t,y),f(t,I),J[k].m(I,null),u(s,A,n),u(s,L,n),O&&O.m(L,null),u(s,N,n),u(s,B,n),f(B,D),f(D,R),K=!0},p(s,[e]){s[1]?_||(_=W(),_.c(),_.m(j,null)):_&&(_.d(1),_=null);let t=k;k=S(s),k===t?J[k].p(s,e):(x(),v(J[t],1,1,(()=>{J[t]=null})),$(),P=J[k],P?P.p(s,e):(P=J[k]=F[k](s),P.c()),g(P,1),P.m(I,null)),O&&O.p&&(!K||16&e)&&b(O,V,s,s[4],e,null,null)},i(s){K||(g(P),g(O,s),K=!0)},o(s){v(P),v(O,s),K=!1},d(s){s&&l(e),_&&_.d(),J[k].d(),s&&l(A),s&&l(L),O&&O.d(s),s&&l(N),s&&l(B)}}}const Y=({session:s,page:e})=>s.user||e.path.includes("login")?{props:{}}:{status:302,redirect:"/login"};function z(s,e,t){let a,n,o;E(s,F,(s=>t(0,n=s))),E(s,S,(s=>t(1,o=s)));let{$$slots:r={},$$scope:i}=e;var c=this&&this.__awaiter||function(s,e,t,a){return new(t||(t=Promise))((function(n,o){function r(s){try{c(a.next(s))}catch(e){o(e)}}function i(s){try{c(a.throw(s))}catch(e){o(e)}}function c(s){var e;s.done?n(s.value):(e=s.value,e instanceof t?e:new t((function(s){s(e)}))).then(r,i)}c((a=a.apply(s,e||[])).next())}))};let l=K({firebase:null,auth:null,firestore:null});return w("store",l),j((()=>c(void 0,void 0,void 0,(function*(){window.ssrUser=a;const s=window.firebase||y(V);window.firebase=s;const e=I(s),t=k(s);l.set({firebase:s,auth:e,firestore:t})})))),s.$$set=s=>{"$$scope"in s&&t(4,i=s.$$scope)},s.$$.update=()=>{1&s.$$.dirty&&(a=n.user||null)},[n,o,function(){return c(this,void 0,void 0,(function*(){yield fetch("/auth/logout",{method:"post"}),yield _("/logout")}))},r,i]}export default class extends e{constructor(s){super(),t(this,s,z,T,a,{})}}export{Y as load};
